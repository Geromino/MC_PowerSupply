#line 1 "G:/Projects/PowerSupply_Co_Yishay/mikroC/test_01.03.20/test.c"
#line 1 "g:/projects/powersupply_co_yishay/mikroc/test_01.03.20/lcd.h"






extern void lcd_puts(char row, char column, const char *s);

extern void lcd_putch(char row, char column, char out_char);

extern void lcd_decimal(char row, char column, unsigned int num);
extern void lcd_clear();
extern void UpArrow(char pos_row, char pos_char);
extern void DownArrow(char pos_row, char pos_char);
extern void numToLcd(char row, char column, unsigned char num);
#line 17 "G:/Projects/PowerSupply_Co_Yishay/mikroC/test_01.03.20/test.c"
unsigned char counter;
int position;
void sw_delayms(unsigned int d);
int value[7];
#line 25 "G:/Projects/PowerSupply_Co_Yishay/mikroC/test_01.03.20/test.c"
void system_init ();
char encoder(char last, char pols);
void ADC_Init();
unsigned int ADC_Read(unsigned char channel);



typedef unsigned char uint8_t;
typedef unsigned int uint16_t;
typedef unsigned long int uint32_t;

const unsigned char sinewave[256] =
{
0x80,0x83,0x86,0x89,0x8c,0x8f,0x92,0x95,0x98,0x9c,0x9f,0xa2,0xa5,0xa8,0xab,0xae,
0xb0,0xb3,0xb6,0xb9,0xbc,0xbf,0xc1,0xc4,0xc7,0xc9,0xcc,0xce,0xd1,0xd3,0xd5,0xd8,
0xda,0xdc,0xde,0xe0,0xe2,0xe4,0xe6,0xe8,0xea,0xec,0xed,0xef,0xf0,0xf2,0xf3,0xf5,
0xf6,0xf7,0xf8,0xf9,0xfa,0xfb,0xfc,0xfc,0xfd,0xfe,0xfe,0xff,0xff,0xff,0xff,0xff,
0xff,0xff,0xff,0xff,0xff,0xff,0xfe,0xfe,0xfd,0xfc,0xfc,0xfb,0xfa,0xf9,0xf8,0xf7,
0xf6,0xf5,0xf3,0xf2,0xf0,0xef,0xed,0xec,0xea,0xe8,0xe6,0xe4,0xe2,0xe0,0xde,0xdc,
0xda,0xd8,0xd5,0xd3,0xd1,0xce,0xcc,0xc9,0xc7,0xc4,0xc1,0xbf,0xbc,0xb9,0xb6,0xb3,
0xb0,0xae,0xab,0xa8,0xa5,0xa2,0x9f,0x9c,0x98,0x95,0x92,0x8f,0x8c,0x89,0x86,0x83,
0x80,0x7c,0x79,0x76,0x73,0x70,0x6d,0x6a,0x67,0x63,0x60,0x5d,0x5a,0x57,0x54,0x51,
0x4f,0x4c,0x49,0x46,0x43,0x40,0x3e,0x3b,0x38,0x36,0x33,0x31,0x2e,0x2c,0x2a,0x27,
0x25,0x23,0x21,0x1f,0x1d,0x1b,0x19,0x17,0x15,0x13,0x12,0x10,0x0f,0x0d,0x0c,0x0a,
0x09,0x08,0x07,0x06,0x05,0x04,0x03,0x03,0x02,0x01,0x01,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x02,0x03,0x03,0x04,0x05,0x06,0x07,0x08,
0x09,0x0a,0x0c,0x0d,0x0f,0x10,0x12,0x13,0x15,0x17,0x19,0x1b,0x1d,0x1f,0x21,0x23,
0x25,0x27,0x2a,0x2c,0x2e,0x31,0x33,0x36,0x38,0x3b,0x3e,0x40,0x43,0x46,0x49,0x4c,
0x4f,0x51,0x54,0x57,0x5a,0x5d,0x60,0x63,0x67,0x6a,0x6d,0x70,0x73,0x76,0x79,0x7c
};


void main()
{
 char display[ 4 ];
 char *voltage = "00.0";
 char *current = "0.00";
 unsigned char i;
 unsigned int a, result;


 TRISA = 0xFF;
 TRISB = 0x00;
 TRISC = 0xC0;

 PORTB = 0x00;
 PORTC = 0x00;

 ADCON1 = 0xC0;
 ADCON0 = 0x41;
 CMCON = 0x07;

 lcd_init();
 Lcd_Cmd(_LCD_CURSOR_OFF);

 lcd_puts(1, 1, "Zchar Paparov");

 system_init();
 ADC_Init();

 counter = 0;
 result = 0;

 for(i=0;i< 4 ;i++) display[i]=0;

 while(1)
 {
#line 123 "G:/Projects/PowerSupply_Co_Yishay/mikroC/test_01.03.20/test.c"
 if(!RC6_bit) counter++;
 if(!RC7_bit) counter--;
 PORTB = counter;

 Delay_ms(50);



 a = ADC_Read(0);
 result = 3*a;



 Delay_ms(100);
 voltage[0]= result/1000+48;
 voltage[1]= (result/100)%10+48;
 voltage[3]= (result/10)%10+48;
 Lcd_Out(2,1,voltage);

 Delay_ms(100);

 a = ADC_Read(1);
 result = 5*a;



 Delay_ms(100);
 current[0]= result/1000+48;
 current[2]= (result/100)%10+48;
 current[3]= (result/10)%10+48;

 Lcd_Out(2,10,current);
#line 169 "G:/Projects/PowerSupply_Co_Yishay/mikroC/test_01.03.20/test.c"
 }
}

void ADC_Init()
{
 ADCON0 = 0x41;
 ADCON1 = 0xC5;

}

unsigned int ADC_Read(unsigned char channel)
{
 if(channel > 7)
 return 0;

 ADCON0 &= 0xC5;
 ADCON0 |= channel<<3;
 Delay_ms(2);
 GO_DONE_bit = 1;
 while(GO_DONE_bit);
 return ((ADRESH<<8)+ADRESL);
}

char encoder(char last, char pols)
{
 char count = last;
 char temp = pols;

 switch(pols)
 {
 case 0x00: if(temp==0x80)
 count++;
 if(temp==0x40)
 count--;
 break;
 case 0x80: if(temp==0xC0)
 count++;
 if(temp==0x00)
 count--;
 break;
 case 0xC0: if(temp==0x40)
 count++;
 if(temp==0x80)
 count--;
 break;
 case 0x40: if(temp==0x00)
 count++;
 if(temp==0xC0)
 count--;
 break;
 }

 return count;
}
void sw_delayms(unsigned int d)
{
 int x, y;
 for(x=0;x<d;x++)
 for(y=0;y<=1275;y++);
}

void system_init()
{

 TRISA.B4 = 1;
 TRISC.B6 = 1;
 TRISC.B7 = 1;

 position =  RC7_bit ;
}
